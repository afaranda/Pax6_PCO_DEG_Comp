
R version 3.4.4 (2018-03-15) -- "Someone to Lean On"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> ################################################################################
> # File: Pax6Epi_PCO_Write_Excel.R                                              #
> # Author: Adam Faranda                                                         #
> # Created: June 28, 2019                                                       #
> # Purpose: Write overlapping differential expression results to spreadsheets   #
> #                                                                              #
> ################################################################################
> 
> # Setup Workspace
> library('openxlsx')
> library('dplyr')

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> wd<-getwd()
> data_dir<-paste(wd, "data_files", sep="/")
> out_dir<-paste(wd, "analysis_results", sep="/")
> source('Pax6Epi_PCO_Compare_Overlap.R')
[1] "Rows in  1 : 14108 Unique MGI.Symbol:  14108"
[1] "Rows in  2 : 14594 Unique MGI.Symbol:  14594"
[1] "Rows in  3 : 14675 Unique MGI.Symbol:  14675"
[1] "Rows in  4 : 16506 Unique MGI.Symbol:  16506"
[1] "Rows in  5 : 16037 Unique MGI.Symbol:  16037"
[1] "############ FILTER DEG:  WT_0_Hour_vs_WT_24_Hour ##########"
[1] "RPKM Filtering Cols: S1_RPKM S2_RPKM S3_RPKM S4_RPKM S5_RPKM S6_RPKM"
[1] "############ FILTER DEG:  WT_0_Hour_vs_WT_48_Hour ##########"
[1] "RPKM Filtering Cols: S1_RPKM S2_RPKM S3_RPKM S7_RPKM S8_RPKM S9_RPKM"
[1] "############ FILTER DEG:  WT0vsWT24 ##########"
[1] "############ FILTER DEG:  WT0vsWT6 ##########"
[1] "Row Count Verification (expect 0): 0"
[1] "########## Confirm Unique Gene IDs in each Contrast (All)#########"
[1] "WT_0_Hour WT_24_Hour Rows: 14594 Unique_Genes: 14594"
[1] "WT_0_Hour WT_24_Hour Rows: 16506 Unique_Genes: 16506"
[1] "WT_0_Hour WT_48_Hour Rows: 14675 Unique_Genes: 14675"
[1] "WT_0_Hour WT_6_Hour Rows: 16037 Unique_Genes: 16037"
[1] "PAX6LEplusplus PAX6LEplusminus Rows: 14108 Unique_Genes: 14108"
> 
> master<-list.files(pattern="master_tables")
> if (length(master) > 0) { 
+   load(master[1])
+ } else {
+   source("Pax6Epi_PCO_Build_Master_Tables.R")
+ }
> 
> print(data_dir)
[1] "/home/adam/Documents/Pax6_PCO_DEG_Comp/data_files"
> # Fix group variable from Pax6 Experiment
> ss_master$Group_1<-gsub("PAX6LEplusplus", "plusplus", ss_master$Group_1)
> ag_master$Group_1<-gsub("PAX6LEplusplus", "plusplus", ag_master$Group_1)
> ss_master$Group_2<-gsub("PAX6LEplusminus", "plusminus", ss_master$Group_2)
> ag_master$Group_2<-gsub("PAX6LEplusminus", "plusminus", ag_master$Group_2)
> 
> # Build annotation table
> an<-ss_master %>% 
+   group_by(MGI.symbol) %>% 
+   filter(row_number(MGI.symbol) == 1) %>%
+   select(MGI.symbol, ensembl_gene_id, description)
> an<-data.frame(an, stringsAsFactors = F)
> 
> # list of filter condtions to select comparison subsets of ss_master
> evaluationList<-list(
+   c("DNA", "WT_6_Hour"),
+   c("DNA", "WT_24_Hour"),
+   c("DBI", "WT_24_Hour"),
+   c("DBI", "WT_48_Hour")
+ )
> 
> 
> # First Contrast is Wildtype vs Pax6 Heterozygous lens epithelium
> dg1<-ss_master %>% filter(Lab == "DNA", Group_2 == "plusminus")
> e<-evaluationList[1]
> 
> 
> # Iterate through a list of second contrasts from the PCO data set
> for(e in evaluationList){
+   
+   dg2<-ss_master %>% filter(Lab == e[1], Group_2 == e[2])
+   
+   # Query joins two pairwise contrasts
+   allResults<-query(dg1, dg2)
+   bioResults<-bioSig(allResults)
+   
+   # Get individual deg summary tables
+   degTable.dg1<-degSummary(dg1)
+   degTable.dg2<-degSummary(dg2)
+   
+   # Get intersection tables and directional subsets
+   stat.tables<-subsetTables(
+     allResults, descname = T, annot = an,
+     Contrast_1 = "WTvP6", 
+     Contrast_2= paste(
+       "WT0v", gsub("_","",gsub("Hour","",e[2])), sep=""
+     )
+   )
+   bio.tables<-subsetTables(
+     bioResults, descname = T, annot = an, stat=F,
+     Contrast_1 = "Pax6_LE", Contrast_2= paste(
+       "WT0v", gsub("_","",gsub("_","",e[2])), sep=""
+     )                  
+   )
+   # Get contingency tables for intersection
+   stat.inx<-tabulateOverlap(stat.tables, rename = T)
+   bio.inx <-tabulateOverlap(bio.tables, rename = T)
+   
+ 
+   print(degTable.dg1)
+   print(degTable.dg2)
+ 
+   print(stat.inx)
+   print(bio.inx)
+   print(
+     paste(
+       e[1], e[2], "All Results:", nrow(allResults),
+       "Bio Results:", nrow(bioResults) 
+     )
+   )
+   
+   wb<-loadWorkbook(
+     paste(data_dir,
+           list.files(data_dir,pattern='Comparisons.xlsx'),
+           sep="/"
+     )
+   )
+   
+   # Delete "Contrasts tab from directional subsets
+   stat.tables["Contrasts"]<-NULL
+   bio.tables["Contrasts"]<-NULL
+   
+   # Tabulate Statistically Significant, and Biologically Significant Genes from each contrast
+   writeData(wb, 1, degTable.dg1, startCol=2, startRow=32,colNames=F) # Add DEG counts to main page
+   writeData(wb, 1, degTable.dg2, startCol=2, startRow=37,colNames=F) # Add DEG counts to main page
+   
+   # Tabulate Statistically Significant Intersection between the two data sets
+   writeData(wb, 1, stat.inx, startCol=3, startRow=42,colNames=F, rowNames = F)
+   
+   # Tabulate Biologically Significant Intersection between the two data sets
+   writeData(wb, 1, bio.inx, startCol=3, startRow=46,colNames=F, rowNames = F)
+   
+   tx<-createStyle(numFmt="TEXT")
+   
+   # Add statistically significant directional subsets to workbook object
+   for(i in names(stat.tables)){
+     addWorksheet(wb,i)
+     print(nrow(stat.tables[[i]]))
+     cells<-expand.grid(
+       row=nrow(stat.tables[[i]]), 
+       col=grep("MGI.symbol", 
+                names(stat.tables[[i]])
+       )
+     )
+     addStyle(wb, i, rows=cells$row, cols=cells$col, style=tx)
+     writeData(wb, i, stat.tables[[i]])
+   }
+   
+   # Add biologically significant directional subsets to workbook object
+   for(i in names(bio.tables)){
+     addWorksheet(wb,i)
+     print(nrow(bio.tables[[i]]))
+     cells<-expand.grid(
+       row=nrow(bio.tables[[i]]), 
+       col=grep("MGI.symbol", 
+                names(bio.tables[[i]])
+       )
+     )
+     addStyle(wb, i, rows=cells$row, cols=cells$col, style=tx)
+     writeData(wb, i, bio.tables[[i]])
+   }
+   
+   # Save workbooks to file  
+   fn<-paste("WTvP6",e[1],e[2], sep="_")
+   fn<-paste(fn, ".xlsx", sep="")
+   saveWorkbook(wb, paste(out_dir,fn, sep="/"), overwrite=T)
+   
+ }
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
                   criteria Total  Up Down
1 Statistically Significant  1657 817  840
2  Biologically Significant  1128 618  510
                   criteria Total  Up Down
1 Statistically Significant  1134 940  194
2  Biologically Significant   844 742  102
             WTvP6_UP WTvP6_Down
WT0vWT6_Up        204         84
WT0vWT6_Down        2         14
                 Pax6_LE_UP Pax6_LE_Down
WT0vWT6Hour_Up          147           50
WT0vWT6Hour_Down          1            9
[1] "DNA WT_6_Hour All Results: 304 Bio Results: 207"
[1] 304
[1] 84
[1] 14
[1] 204
[1] 2
[1] 207
[1] 50
[1] 9
[1] 147
[1] 1
Note: zip::zip() is deprecated, please use zip::zipr() instead
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
                   criteria Total  Up Down
1 Statistically Significant  1657 817  840
2  Biologically Significant  1128 618  510
                   criteria Total   Up Down
1 Statistically Significant  3165 1585 1580
2  Biologically Significant  2322 1274 1048
              WTvP6_UP WTvP6_Down
WT0vWT24_Up        380         14
WT0vWT24_Down       47        448
                  Pax6_LE_UP Pax6_LE_Down
WT0vWT24Hour_Up          281            6
WT0vWT24Hour_Down         23          294
[1] "DNA WT_24_Hour All Results: 889 Bio Results: 604"
[1] 889
[1] 14
[1] 448
[1] 380
[1] 47
[1] 604
[1] 6
[1] 294
[1] 281
[1] 23
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
                   criteria Total  Up Down
1 Statistically Significant  1657 817  840
2  Biologically Significant  1128 618  510
                   criteria Total   Up Down
1 Statistically Significant  2538 1460 1078
2  Biologically Significant  1928 1141  787
              WTvP6_UP WTvP6_Down
WT0vWT24_Up        403         17
WT0vWT24_Down       29        258
                  Pax6_LE_UP Pax6_LE_Down
WT0vWT24Hour_Up          302           10
WT0vWT24Hour_Down         18          184
[1] "DBI WT_24_Hour All Results: 707 Bio Results: 514"
[1] 707
[1] 17
[1] 258
[1] 403
[1] 29
[1] 514
[1] 10
[1] 184
[1] 302
[1] 18
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
 [1] "MGI.symbol"      "ensembl_gene_id" "description"     "dg1.lfc"        
 [5] "dg1.fdr"         "dg1.a1"          "dg1.a2"          "dg2.lfc"        
 [9] "dg2.fdr"         "dg2.a1"          "dg2.a2"         
                   criteria Total  Up Down
1 Statistically Significant  1657 817  840
2  Biologically Significant  1128 618  510
                   criteria Total   Up Down
1 Statistically Significant  3503 1982 1521
2  Biologically Significant  2507 1569  938
              WTvP6_UP WTvP6_Down
WT0vWT48_Up        452         20
WT0vWT48_Down       43        317
                  Pax6_LE_UP Pax6_LE_Down
WT0vWT48Hour_Up          339           10
WT0vWT48Hour_Down         23          205
[1] "DBI WT_48_Hour All Results: 832 Bio Results: 577"
[1] 832
[1] 20
[1] 317
[1] 452
[1] 43
[1] 577
[1] 10
[1] 205
[1] 339
[1] 23
> print(sessionInfo())
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.2 LTS

Matrix products: default
BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] dplyr_0.8.1      openxlsx_4.1.0.1

loaded via a namespace (and not attached):
 [1] tidyselect_0.2.5 compiler_3.4.4   magrittr_1.5     assertthat_0.2.1
 [5] R6_2.4.0         pillar_1.4.1     glue_1.3.1       tibble_2.1.3    
 [9] crayon_1.3.4     Rcpp_1.0.1       zip_2.0.2        pkgconfig_2.0.2 
[13] rlang_0.4.0      purrr_0.3.2     
> 
> 
> 
> 
> proc.time()
   user  system elapsed 
 21.607   0.599  22.417 
